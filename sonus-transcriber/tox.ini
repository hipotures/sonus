[tox]
envlist = py311
isolated_build = True
skip_missing_interpreters = True

[testenv]
deps =
    -r{toxinidir}/requirements.txt
    -r{toxinidir}/requirements-test.txt
commands =
    pytest {posargs:tests} --cov=src/transcriber --cov-report=term-missing --cov-report=xml

[testenv:lint]
deps =
    flake8==7.0.0
    black==24.2.0
    isort==5.13.2
commands =
    flake8 src/transcriber tests
    black --check src/transcriber tests
    isort --check-only src/transcriber tests

[testenv:type]
deps =
    mypy==1.8.0
    types-requests==2.31.0.20240218
    types-setuptools==69.1.0.20240217
    types-urllib3==1.26.25.14
commands =
    mypy src/transcriber

[testenv:security]
deps =
    bandit==1.7.7
    safety==2.3.5
commands =
    bandit -r src/transcriber
    safety check

[testenv:format]
deps =
    black==24.2.0
    isort==5.13.2
commands =
    black src/transcriber tests
    isort src/transcriber tests

[flake8]
max-line-length = 100
extend-ignore = E203, W503
exclude =
    .tox,
    .git,
    __pycache__,
    build,
    dist,
    *.egg-info

[isort]
profile = black
multi_line_output = 3
include_trailing_comma = True
force_grid_wrap = 0
use_parentheses = True
ensure_newline_before_comments = True
line_length = 100

[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = -ra -q
markers =
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    slow: marks tests as slow (skipped by default)
    gpu: marks tests requiring GPU
